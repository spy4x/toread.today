<ng-template #signInSection>
  <button (click)="signIn()" class="button">Sign in</button>
</ng-template>

<div *ngIf="user$ | async as user; else signInSection">
  <h4>User: {{user.displayName}}</h4>
  <button (click)="signOut()">Sign out</button>
  <hr>
  <ng-template #loading>
    Loading...
  </ng-template>
  <div *ngIf="items$ | async as items; else loading">
    <input placeholder="Enter url"
           #input
           (keydown.enter)="addItem(input.value, user.uid)">
    <p style="color: red" *ngIf="addItemError">{{addItemError}}</p>
    <p style="color: red" *ngIf="startReadingError">{{startReadingError}}</p>
    <p style="color: red" *ngIf="finishReadingError">{{finishReadingError}}</p>
    <p *ngIf="!items.length">No items yet.</p>
    <hr>
    <h3 class="title">Reading:</h3>
    <p style="color: red" *ngIf="loadInProgressItemsError">{{loadInProgressItemsError}}</p>
    <div class="items">
      <div *ngFor="let item of inProgressItems$ | async" class="items__item">
        <p class="items__item__type">{{item.type}}</p>
        <p class="items__item__primary-text">{{item.title || item.url}}</p>
        <p class="items__item__secondary-text">{{item.description || (item.title && item.url)}}</p>
        <div class="">
          <button class="button is-warning" (click)="finishReading(item.id)">Mark as finished</button>
          <button class="button is-success" (click)="undoReading(item.id)">Mark as unread</button>
        </div>
        <hr>
      </div>
    </div>

    <hr>

    <h3 class="title">All: (click to open in new tab)</h3>
    <p style="color: red" *ngIf="loadAllItemsError">{{loadAllItemsError}}</p>
    <div class="items">
      <div *ngFor="let item of items" class="items__item" (click)="startReading(item.id)">
        <p class="items__item__type">{{item.type}}</p>
        <p class="items__item__primary-text">{{item.title || item.url}}</p>
        <p class="items__item__secondary-text">{{item.description || (item.title && item.url)}}</p>
        <hr>
      </div>
    </div>

    <hr>

    <h3 class="title">Finished: (click to unread)</h3>
    <p style="color: red" *ngIf="loadinFinishedItemsError">{{loadinFinishedItemsError}}</p>
    <div class="items">
      <div *ngFor="let item of inFinishedItems$ | async" class="items__item" (click)="undoReading(item.id)">
        <p class="items__item__type">{{item.type}}</p>
        <p class="items__item__primary-text">{{item.title || item.url}}</p>
        <p class="items__item__secondary-text">{{item.description || (item.title && item.url)}}</p>
        <hr>
      </div>
    </div>
  </div>
</div>
